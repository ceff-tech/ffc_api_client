<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • ffcAPIClient</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta property="og:description" content="ffcAPIClient">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ffcAPIClient</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.8.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ceff-steps.html">Use ffcAPIClient to Follow CEFF Steps</a>
    </li>
    <li>
      <a href="../articles/getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/run_multiple_gages.html">Run Multiple Gages</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started</h1>
            
      
      
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>To get this package up and running, you’ll want to make sure you have the most recent R version available (download <a href="https://cran.r-project.org/" class="external-link">here</a>). In addition, you’ll need the the {<code>devtools</code>} package. Basic installation instructions as follows:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Get {<code>devtools</code>} installed</strong>: If you don’t already have it, run <code>install.packages('devtools')</code> in your R console, or install the package any way you prefer.</p></li>
<li>
<p><strong>Install the {<code>ffcAPIClient</code>} package</strong>:</p>
<ul>
<li>
<code>devtools::install_github('ceff-tech/ffc_api_client/ffcAPIClient')</code>.</li>
<li>If you get an error on this installation step, make sure you are using the latest version of R and of the {<code>devtools</code>} package.</li>
</ul>
</li>
<li>
<p><strong>Retrieve your eflows API token</strong>: Now we need to retrieve your token.</p>
<ol style="list-style-type: lower-alpha">
<li>In Firefox or Chrome, log into <a href="https://eflows.ucdavis.edu" class="external-link uri">https://eflows.ucdavis.edu</a>. Once logged in, make sure you are on your user profile page at <a href="https://eflows.ucdavis.edu/profile" class="external-link uri">https://eflows.ucdavis.edu/profile</a> and then press <code>F12</code> on your keyboard to bring up the Inspector, then switch to the Console tab.</li>
<li>In the console, type <code>localStorage.getItem('ff_jwt')</code>—you may need to type it in yourself instead of pasting (or follow Firefox’s instructions to enable pasting—it will tell you how after you try to paste). Hit <code>Enter</code> to send the command.</li>
<li>Your browser will place text on the line below the command you typed - this is your “token”. Save this value and copy it to your clipboard and we’ll use it below. This value should stay private—if other people knew the value, they could use it to access your account on <a href="eflows.ucdavis.edu">eflows.ucdavis.edu</a>.</li>
</ol>
</li>
<li>
<p><strong>Save Your Token</strong>: One recommended option is to save your token is with the <a href="https://usethis.r-lib.org/" class="external-link">{<code>usethis</code>}</a> package. To do so, install the package and then run <code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code> to edit your <code>.Renviron</code>. Add your token as shown below, make sure there is an empty line at the bottom of the file, and save the file.</p>
<pre><code>EFLOWS_TOKEN='very_long_string_of_letters_and_numbers`</code></pre>
<p>Once you have saved your token in your <code>.Renviron</code> file, restart R, and you can access it via: <code>ffctoken &lt;- set_token(Sys.getenv("EFLOWS_TOKEN", ""))</code> and use <code>ffctoken</code> instead of pasting your full key.</p>
</li>
</ol>
<p><br></p>
<p>That’s it. You can now run data through the online FFC using this package and process the results.</p>
<hr>
</div>
<div class="section level2">
<h2 id="usage-examples">Usage Examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a>
</h2>
<p>There are more detailed tutorials available under the <strong>Articles</strong> menu, including:</p>
<ul>
<li><a href="https://ceff-tech.github.io/ffc_api_client/articles/ceff-steps.html" class="external-link"><strong>Following the CEFF Steps Vignette</strong></a></li>
<li><a href="https://ceff-tech.github.io/ffc_api_client/articles/run_multiple_gages.html" class="external-link"><strong>How to pull FFC data for multiple USGS Gages</strong></a></li>
</ul>
<p>It’s recommended you run the steps above on your own, but the package includes other ways to run similar workflows for gage data or for timeseries data of your own. The general steps to run anything require your token, and initializing a processor to run data through.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ffcAPIClient</span><span class="op">)</span>

<span class="co"># start ffc processor</span>
<span class="va">ffc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/FFCProcessor.html">FFCProcessor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="ffc-for-a-single-usgs-gage">FFC for a Single USGS Gage<a class="anchor" aria-label="anchor" href="#ffc-for-a-single-usgs-gage"></a>
</h3>
<p>To calculate functional flow metrics (FFM) for a single gage, we need to provide the gage and the token. We can also provide the COMID and plot_output_folder (where all the results and plots go), but these are optional. If you don’t specify an output folder, the results end up in your R environment and you can save them later.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set token if in .Rprofile as described in instructions above</span>
<span class="va">ffctoken</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_token.html">set_token</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"EFLOWS"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span>

<span class="co"># or just add manually:</span>
<span class="va">ffctoken</span> <span class="op">&lt;-</span> <span class="st">"MYVERYLONGTOKEN_NUMBER_HERE"</span>

<span class="co"># start ffc processor</span>
<span class="va">ffc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/FFCProcessor.html">FFCProcessor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">ffc</span><span class="op">$</span><span class="fu">set_up</span><span class="op">(</span>gage_id <span class="op">=</span> <span class="fl">11427000</span>,
           token <span class="op">=</span> <span class="va">ffctoken</span>, 
           <span class="co"># OPTIONAL</span>
           comid <span class="op">=</span> <span class="va">segment_comid</span>,
           plot_output_folder <span class="op">=</span> <span class="st">"~/Documents/NFA_Gage_Alteration"</span><span class="op">)</span></code></pre></div>
<p>After running the <code>ffc$set_up()</code>, we should get back some information about the <code>ffcAPIClient</code> version, as well as message stating how many water years will be excluded because of more than 7 days of missing data.</p>
<pre><code>INFO [2020-11-21 12:00:00] ffcAPIClient Version 0.9.8.2
INFO [2020-11-21 12:00:00] Excluding water years 2021 for having more than 7 missing days of data</code></pre>
<p>Finally, we run the calculator, which will return all our data in the <strong><code>ffc</code></strong> object, see below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ffc</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>INFO [2020-11-21 12:00:00] Using date format string %m/%d/%Y
INFO [2020-11-21 12:00:00] COMID 14996611 is of stream class LSR - sending parameters to FFC online for that stream class. This may produce different results than if you run data through the FFC yourself using their default parameters.</code></pre>
<p>The <strong><code>ffc</code></strong> object contains all the data we may be interested in including:</p>
<ul>
<li>
<code>ffc_results</code> includes the raw data from the functional flows calculator for each flow metric by day of water year.</li>
<li>
<code>ffc_percentiles</code> includes the calculated 10th, 25th, 50th, 75th, and 90th percentiles for each metric.</li>
<li>
<code>alteration</code> data frame includes the assessed alteration of each metric using CEFF Appendix F Rules.</li>
<li>
<code>predicted_percentiles</code> includes the same percentiles as predicted for each metric for assessing the observed ffc results against predicted unaltered flow.</li>
<li>
<code>doh_data</code> contains the raw dimensionless hydrograph data with columns for percentiles and rows for days of water year.</li>
</ul>
<p>See the <a href="#documentation">documentation</a> for more information on these results.</p>
<p>We can save each of these individually however we choose using something like <code>write.csv(ffc$ffc_results, file="my_output_folder/ffc_results.csv)</code>. However, to save everything all at once, see below to learn how to <a href="#save-all-the-ffc-results-into-a-single-folder">Save All Results into a Single Folder</a>.</p>
</div>
<div class="section level3">
<h3 id="save-results-in-a-single-folder">Save Results In a Single Folder<a class="anchor" aria-label="anchor" href="#save-results-in-a-single-folder"></a>
</h3>
<p>If we want to save all the above results to a folder directly, we can use the <strong><code><a href="../reference/evaluate_gage_alteration.html">evaluate_gage_alteration()</a></code></strong> function. This will get all the results and save them to a single directory you specify. It requires the same arguments as above. However, the <code>plot_output_folder</code> remains optional, and when provided, plots and data will be saved in that location. Plots will show in your R environment (the <code>Plots</code> tab in RStudio) regardless.</p>
<p>Providing the COMID is preferred, though there are look up options available. See the function documentation for details regarding how to optionally re-enable the lookup.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If you have a gage and a token, you can get all results simply by running</span>
<span class="fu">ffcAPIClient</span><span class="fu">::</span><span class="fu"><a href="../reference/evaluate_gage_alteration.html">evaluate_gage_alteration</a></span><span class="op">(</span>gage_id <span class="op">=</span> <span class="fl">11427000</span>, 
                                       token <span class="op">=</span> <span class="st">"your_token"</span>, 
                                       comid <span class="op">=</span> <span class="va">segment_comid</span>,
                                       plot_output_folder <span class="op">=</span> <span class="st">"C:/Users/youruser/Documents/NFA_Gage_Alteration"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ffc-with-your-own-flow-data">FFC with Your Own Flow Data<a class="anchor" aria-label="anchor" href="#ffc-with-your-own-flow-data"></a>
</h3>
<p>If you have your own flow data, as long as it is a data frame with flow and date fields, we can use the same functions as described above. However, we need to specify the dataframe containing:</p>
<ul>
<li>
<code>flow</code> column with daily flow data</li>
<li>
<code>date</code> column, ideally formatted as “YYYY-MM-DD”</li>
</ul>
<p>To run this data, we can use the following, note, the date format default is for “YYYY-MM-DD” but you can specify an alternate format (type <code><a href="https://rdrr.io/r/base/strptime.html" class="external-link">?strptime</a></code> in your R console to see the Help file with date specifications). <strong>Note</strong>, <code>COMID</code> is required or a <code>latitude/longitude</code> must be provided.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ffcAPIClient</span><span class="fu">::</span><span class="fu"><a href="../reference/evaluate_alteration.html">evaluate_alteration</a></span><span class="op">(</span>
  timeseries_df <span class="op">=</span> <span class="va">your_df</span>, 
  token <span class="op">=</span> <span class="st">"your_token"</span>, 
  plot_output_folder <span class="op">=</span> <span class="st">"C:/Users/youruser/Documents/Timeseries_Alteration"</span>,
  comid<span class="op">=</span><span class="va">yoursegmentcomid</span><span class="op">)</span> <span class="co"># REQUIRED OR specify lat/lon</span>
<span class="co"># additional arguments:</span>
  <span class="co"># longitude = ,</span>
  <span class="co"># latitude = ,</span>
  <span class="co"># plot_results = TRUE, # default is TRUE</span>
  <span class="co"># plot_output_folder = , # where to save things</span>
  <span class="co"># date_format_string = "") # to specify a custom date format, default is YYYY-MM-DD)</span></code></pre></div>
<p>This function, and <code><a href="../reference/evaluate_gage_alteration.html">evaluate_gage_alteration()</a></code>, plot results immediately and optionally save the plots to the output folder.</p>
</div>
<div class="section level3">
<h3 id="getting-predicted-flow-metrics-from-a-comid">Getting Predicted Flow Metrics from a COMID<a class="anchor" aria-label="anchor" href="#getting-predicted-flow-metrics-from-a-comid"></a>
</h3>
<p>This package compares the percentiles generated from the observed data and the percentiles predicted by modeling. As part of this functionality, the code includes the full results of the modeling output as a data frame accessible in <code><a href="../reference/flow_metrics.html">ffcAPIClient::flow_metrics</a></code>. More practically, if you have a variable <code>com_id</code> that stores an NHD stream segment identifier (COMID), then you can also use <code>ffcAPIClient::get_predicted_flow_metrics(com_id)</code> to retrieve a data frame with only the results for that segment. For example, for the Goodyear’s Bar reference gage segment on the North Yuba:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ffcAPIClient</span><span class="fu">::</span><span class="fu"><a href="../reference/get_predicted_flow_metrics.html">get_predicted_flow_metrics</a></span><span class="op">(</span><span class="st">"8058513"</span><span class="op">)</span></code></pre></div>
<pre><code>                Metric   COMID          p10          p25         p50          p75          p90 source
38433        DS_Dur_WS 8058513 8.467500e+01 1.146312e+02   145.00000 1.765000e+02 2.015200e+02  model
178679       DS_Mag_50 8058513 3.550966e+01 5.372067e+01    83.01238 1.227657e+02 1.446242e+02  model
318925       DS_Mag_90 8058513 7.209266e+01 1.018497e+02   156.52111 2.332115e+02 3.339129e+02  model
459171          DS_Tim 8058513 2.788200e+02 2.880000e+02   300.90000 3.115000e+02 3.241325e+02  model
583991          FA_Dur 8058513 2.000000e+00 3.000000e+00     4.00000 6.000000e+00 8.000000e+00    obs
670137          FA_Mag 8058513 1.129055e+02 1.711441e+02   270.44481 4.731658e+02 8.309241e+02  model
810383          FA_Tim 8058513 7.830000e+00 1.444375e+01    23.46667 3.002500e+01 4.729750e+01  model
950629         Peak_10 8058513 8.031502e+03 1.316898e+04 19158.34402 2.434368e+04 2.613562e+04  model
1090875        Peak_5 8058513 5.456749e+03 8.858951e+03 13062.81469 1.348278e+04 1.642180e+04  model
1231121        Peak_2 8058513 2.903039e+03 4.493501e+03  5484.65786 6.384782e+03 1.405851e+04  model
1355941    Peak_Dur_10 8058513 1.000000e+00 1.000000e+00     1.00000 2.000000e+00 4.000000e+00    obs
1426661    Peak_Dur_5 8058513 1.000000e+00 1.000000e+00     2.00000 3.000000e+00 6.000000e+00    obs
1497381    Peak_Dur_2 8058513 1.000000e+00 1.000000e+00     4.00000 1.000000e+01 2.900000e+01    obs
1568101    Peak_Fre_10 8058513 1.000000e+00 1.000000e+00     1.00000 1.000000e+00 2.000000e+00    obs
1638821    Peak_Fre_5 8058513 1.000000e+00 1.000000e+00     1.00000 2.000000e+00 3.000000e+00    obs
1709541    Peak_Fre_2 8058513 1.000000e+00 1.000000e+00     2.00000 3.000000e+00 5.000000e+00    obs
1795687         SP_Dur 8058513 4.600000e+01 5.500000e+01    67.86250 8.962500e+01 1.210167e+02  model
1935933         SP_Mag 8058513 1.338260e+03 1.826367e+03  2632.40321 4.145245e+03 6.601865e+03  model
2060753         SP_ROC 8058513 3.845705e-02 4.863343e-02     0.06250 8.132020e-02 1.141117e-01    obs
2146899         SP_Tim 8058513 1.805000e+02 2.149063e+02   232.00000 2.414292e+02 2.515050e+02  model
2287145    Wet_BFL_Dur 8058513 6.648750e+01 9.409375e+01   137.38750 1.738125e+02 1.970433e+02  model
2427391 Wet_BFL_Mag_10 8058513 1.370541e+02 2.052893e+02   333.09236 4.704166e+02 5.683843e+02  model
2567637 Wet_BFL_Mag_50 8058513 4.369753e+02 6.272972e+02   824.51279 1.083330e+03 1.360226e+03  model
2707883        Wet_Tim 8058513 4.638500e+01 5.857500e+01    72.42500 9.511667e+01 1.187900e+02  model</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="additional-ffcprocessor-input-options">Additional FFCProcessor Input Options<a class="anchor" aria-label="anchor" href="#additional-ffcprocessor-input-options"></a>
</h2>
<p>There are many options that are available for the user to specify within the <strong><code>FFCProcessor</code></strong> object. These should be called prior to the <code>setup</code> and <code>run</code> functions, and some may be overwritten by parameters to <code>$setup</code>. Here are a few options to be aware of:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set new processor</span>
<span class="va">ffc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/FFCProcessor.html">FFCProcessor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="co"># then specify options:</span>
<span class="va">ffc</span><span class="op">$</span><span class="va">date_field</span> <span class="op">=</span> <span class="st">"date"</span> <span class="co"># change to whatever column name contains date</span>

<span class="co">## ADDITIONAL OPTIONS: ##</span>
<span class="co"># start_date = "10/1", # defaults to Water Year</span>
<span class="co"># date_format_string = "%m/%d/%Y", # specify the date format</span>
<span class="co"># date_field = "date",</span>
<span class="co"># flow_field = "flow",</span>
<span class="co"># comid = NA,</span>
<span class="co"># filter_ffc_results = TRUE,  # indicates whether we want to remove anything that's not a flow metric automatically (Julian day results, some diagnostics)</span>
<span class="co"># predicted_percentiles_online = TRUE,  # should we get predicted flow metrics from the online API, or with our offline data?</span>
<span class="co"># plots = NA,</span>
<span class="co"># plot_output_folder = NA,</span>
<span class="co"># alteration = NA,</span>
<span class="co"># fail_years_data = pkg.env$FAIL_YEARS_DATA, # stops processing if we have this many years or fewer after filtering, default is 10</span>
<span class="co"># warn_years_data = 15,  # we'll warn people if we have this many years or fewer after filtering</span>
<span class="co"># timeseries_enable_filtering = pkg.env$FILTER_TIMESERIES, # should we run the timeseries filtering? Stays TRUE internally, but the flag is here for advanced users</span>
<span class="co"># timeseries_max_missing_days = 7,</span>
<span class="co"># timeseries_max_consecutive_missing_days = 1,</span>
<span class="co"># timeseries_fill_gaps = "no",</span>
<span class="co"># timeseries_enable_filtering = pkg.env$FILTER_TIMESERIES, # should we run the timeseries filtering? Stays TRUE internally, but the flag is here for advanced users</span>
<span class="co"># gage_start_date = "", # start_date and end_date are passed straight through to readNWISdv - "" means "retrieve all". Override values should be of the form YYYY-MM-DD</span>
<span class="co"># gage_end_date = "",</span>
<span class="co"># SERVER_URL = 'https://eflows.ucdavis.edu/api/',</span>

<span class="co"># for example, set minimum years required to 2 and start water year to 1980</span>
<span class="va">ffc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/FFCProcessor.html">FFCProcessor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">ffc</span><span class="op">$</span><span class="va">timeseries_enable_filtering</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">ffc</span><span class="op">$</span><span class="va">fail_years_data</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ffc</span><span class="op">$</span><span class="va">gage_start_date</span> <span class="op">&lt;-</span> <span class="st">"1979-10-01"</span>
<span class="va">ffc</span><span class="op">$</span><span class="fu">set_up</span><span class="op">(</span>gage_id<span class="op">=</span><span class="fl">11264500</span>, token <span class="op">=</span> <span class="va">ffctoken</span><span class="op">)</span>
<span class="va">ffc</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="available-ffcprocessor-output-data-frames-and-plots">Available FFCProcessor Output Data Frames and Plots<a class="anchor" aria-label="anchor" href="#available-ffcprocessor-output-data-frames-and-plots"></a>
</h2>
<p>When using the CEFF steps code, many output data frames, such as predicted percentiles, observed percentiles, and alteration assessment data are automatically saved to your output folder. By default, we don’t trigger that code when you run <code>$set_up</code> or <code>$run</code>, but the data is stored on your FFCProcessor object. Using an example where <code>ffc</code> is your FFCProcessor, after running <code>ffc$run</code> you will have the following data frames available:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ffc</span><span class="op">$</span><span class="va">alteration</span>  <span class="co"># alteration assessment data</span>
<span class="va">ffc</span><span class="op">$</span><span class="va">predicted_percentiles</span>  <span class="co"># predicted percentile data</span>
<span class="va">ffc</span><span class="op">$</span><span class="va">ffc_percentiles</span>  <span class="co"># percentiles for observed data run through the FFC</span></code></pre></div>
<p>You can feed this data into any additional processing code you like without plotting or saving it out to files and it will run faster than using the CEFF steps code, though it will give you less verbose output on what it’s doing and how to use it.</p>
<p>You can also then manually feed these data into other package functions like plotting, or to your own code that controls saving it. For example, to manually trigger the comparison plots that are output by CEFF steps code after running <code>ffc$run</code> yourself, you can call:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ffcAPIClient</span><span class="fu">::</span><span class="fu">plot_comparison_boxes</span><span class="op">(</span><span class="va">ffc</span><span class="op">$</span><span class="va">ffc_percentiles</span>, <span class="va">ffc</span><span class="op">$</span><span class="va">predicted_percentiles</span>, output_folder <span class="op">=</span> <span class="st">"C:/the/full/path/to/save/plots/to"</span>, gage_id <span class="op">=</span> <span class="fl">1111111</span><span class="op">)</span></code></pre></div>
<p>If you aren’t plotting a gage, you can leave the <code>gage_id</code> parameter off - it’s only used to look up information to include on the plot.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://nicksantos.com" class="external-link">Nick Santos</a>, <a href="https://ryanpeek.github.io/" class="external-link">Ryan Peek</a>, <a href="https://watershed.ucdavis.edu/people/alyssa-obester" class="external-link">Alyssa Obester</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
